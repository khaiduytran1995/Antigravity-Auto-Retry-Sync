# üîê Ph√¢n T√≠ch H·ªá Th·ªëng License SimpleYTB

## üìã T·ªïng Quan

**SimpleYTB** l√† m·ªôt ·ª©ng d·ª•ng Electron/Tauri ƒë∆∞·ª£c vi·∫øt b·∫±ng Rust, s·ª≠ d·ª•ng h·ªá th·ªëng license t·ª´ **ATP** (Alosoft/Puno). ƒê√¢y l√† h·ªá th·ªëng license t∆∞∆°ng t·ª± v·ªõi c√°c ·ª©ng d·ª•ng kh√°c nh∆∞ `simple-facebook-pro-v2`.

---

## üèóÔ∏è Ki·∫øn Tr√∫c H·ªá Th·ªëng

```mermaid
flowchart TB
    subgraph Client["üñ•Ô∏è SimpleYTB Client"]
        A[Electron App] --> B[renderer.js]
        A --> C[ytb-backend.exe]
        B --> D[License Module]
        B --> E[Windows Registry]
    end
    
    subgraph Servers["‚òÅÔ∏è Remote Servers"]
        F[crm.alosoft.vn]
        G[tool.puno2.com]
        H[localhost:18100]
    end
    
    D --> F
    D --> G
    B --> H
    C --> H
```

---

## üîë C·∫•u Tr√∫c License Key

### Format:
```
ATP-YTB-{HEX_ENCODED_HWID}
```

### V√≠ d·ª• key c·ªßa b·∫°n:
```
ATP-YTB-6630-6533-3532-6566-6337-6533-3535-3161-3833-6232-3438-3962-3764-3236-3461-6233
```

### Gi·∫£i m√£:
| Th√†nh ph·∫ßn | Gi√° tr·ªã |
|------------|---------|
| **Prefix** | `ATP-YTB` |
| **Encoded HWID** | `6630-6533-3532-6566-...` |
| **Decoded HWID** | `f0e352efc7e3551a83b2489b7d264ab3` |
| **Format** | MD5 Hash (32 hex chars, 128-bit) |

### Thu·∫≠t to√°n t·∫°o key:
```javascript
function getHexStringFromMd5(md5Str) {
    let s = '';
    for (let i = 0; i < md5Str.length; i++) {
        const b = md5Str.charCodeAt(i);
        const n1 = b & 15;
        const n2 = (b >> 4) & 15;
        s += n2.toString(16).toUpperCase();
        s += n1.toString(16).toUpperCase();
        if ((i + 1) !== md5Str.length && (i + 1) % 2 === 0) {
            s += '-';
        }
    }
    return s;
}
```

---

## üîÑ Lu·ªìng X√°c Th·ª±c License

```mermaid
sequenceDiagram
    participant App as SimpleYTB App
    participant Reg as Windows Registry
    participant CRM as crm.alosoft.vn
    participant Puno as tool.puno2.com
    
    App->>Reg: 1. ƒê·ªçc license key t·ª´ Registry
    alt Kh√¥ng c√≥ key
        App->>App: T·∫°o key m·ªõi t·ª´ HWID (MD5)
        App->>Reg: L∆∞u key v√†o Registry
    end
    
    App->>CRM: 2. filterBlockUrl() - Ki·ªÉm tra DNS whitelist
    Note over CRM: Whitelist IPs: 45.76.106.225, 45.119.80.6...
    
    App->>App: 3. checkHost() - Ki·ªÉm tra file hosts
    Note over App: Ch·∫∑n n·∫øu hosts ch·ª©a "tool.puno2.com" ho·∫∑c "crm.alosoft.vn"
    
    App->>Puno: 4. getVersionKeyApp() - Ki·ªÉm tra phi√™n b·∫£n
    Note over Puno: GET simple_lic.php?hdd={KEY}&ver=2.1.5
    
    App->>Puno: 5. getFinalKeyKeyApp() - Ki·ªÉm tra h·∫°n s·ª≠ d·ª•ng
    Note over Puno: POST simple_exp4.php (AES encrypted)
    
    alt License h·∫øt h·∫°n
        App->>App: blockLicense()
    end
    
    App->>Reg: 6. checkCrack() - Ki·ªÉm tra crack
    Note over Reg: So s√°nh key m√£ h√≥a trong HKCU\Software\Intel
    
    App->>CRM: 7. checkPcCode() - Ki·ªÉm tra PC code
    Note over CRM: POST check_pc_code.php
    
    App->>App: 8. updateLicenseStatus(true)
```

---

## üåê API Endpoints Chi Ti·∫øt

### 1. **CRM Server** (`crm.alosoft.vn`)

| Endpoint | Method | M·ª•c ƒë√≠ch |
|----------|--------|----------|
| `/requestkey/getkeyapi.php` | POST | Proxy request ƒë·∫øn Puno server |
| `/active-flag-key-encrypt/delete-flag.php?hdd={KEY}` | POST | X√≥a encryption flag |
| `/active-flag-key-encrypt/update_pc_code.php` | POST | C·∫≠p nh·∫≠t PC code |
| `/active-flag-key-encrypt/check_pc_code.php` | POST | Ki·ªÉm tra PC code |
| `/simple-ytb-16-12-2025/index.html` | GET | Load frontend UI |

### 2. **Puno Server** (`tool.puno2.com`)

| Endpoint | Method | M·ª•c ƒë√≠ch |
|----------|--------|----------|
| `/simple_lic.php?hdd={KEY}&ver=2.1.5` | GET | Ki·ªÉm tra phi√™n b·∫£n license |
| `/simple_exp4.php` | POST | Ki·ªÉm tra h·∫°n s·ª≠ d·ª•ng (AES encrypted) |

### 3. **Local Backend** (`localhost:18100`)

| Endpoint | Method | M·ª•c ƒë√≠ch |
|----------|--------|----------|
| `/docs` | GET | Health check |
| `/crawl_hashtag` | POST | Crawl hashtag YouTube |
| `/search_videos` | POST | T√¨m ki·∫øm videos |
| `/analyze` | POST | Ph√¢n t√≠ch videos |
| `/find_channels` | POST | T√¨m ki·∫øm channels |
| `/check_monetization` | POST | Ki·ªÉm tra monetization |
| `/trending` | POST | L·∫•y trending videos |
| `/analyze_video` | POST | Ph√¢n t√≠ch video c·ª• th·ªÉ |
| `/analyze_channel` | POST | Ph√¢n t√≠ch channel |
| `/audit_channel` | POST | Audit SEO channel |
| `/rising_channels` | POST | Ph√¢n t√≠ch rising channels |

---

## üîí C∆° Ch·∫ø B·∫£o V·ªá

### 1. **Anti-Hosts Modification**
```javascript
async function checkHost(platform) {
    // Ki·ªÉm tra file hosts
    // N·∫øu ch·ª©a "tool.puno2.com" ho·∫∑c "crm.alosoft.vn" ‚Üí throw Error
}
```

### 2. **DNS Whitelist**
```javascript
whiteListIp: ['45.76.106.225', '45.119.80.6', '45.124.95.131', '45.76.146.162']
// Ch·ªâ ch·∫•p nh·∫≠n c√°c IP n√†y cho server license
```

### 3. **AES Encryption**
```javascript
const KEY_APP_CONFIG = {
    keyDecode: 'Atpdevdeptrai!@#',        // Key gi·∫£i m√£ URL
    keyGeneralEncrypt: 'Atpdevr5',         // Key m√£ h√≥a chung
    KeyATP: 'ATP-FACEBOOK-533601',         // Key AES cho license data
    keyEncryptName: 'IntelAtomX6425YTB',   // Registry value name
    keyCheckPCCode: 'IntelAtomX6425YTBe'   // PC code registry name
};
```

### 4. **Registry Storage**
```
Location: HKEY_CURRENT_USER\Software\ATP
Value: ATP-YTB = {LICENSE_KEY}

Location: HKEY_CURRENT_USER\Software\Intel
Value: IntelAtomX6425YTB = {ENCRYPTED_KEY}
Value: IntelAtomX6425YTBe = {PC_CODE_UUID}
```

### 5. **Feature Locking**
```javascript
// N·∫øu license kh√¥ng h·ª£p l·ªá, ch·ªâ hi·ªÉn th·ªã 3 k·∫øt qu·∫£
if (!currentLicenseValid && allChannels.length > 3) {
    displayChannels = allChannels.slice(0, 3);
    // Hi·ªÉn th·ªã "üîí Unlock All Results"
}
```

---

## üìä C√°c Tier License (D·ª± ƒëo√°n)

| Tier | Gi·ªõi h·∫°n | T√≠nh nƒÉng |
|------|----------|-----------|
| **Free/Expired** | 3 k·∫øt qu·∫£ | Gi·ªõi h·∫°n t·∫•t c·∫£ t√≠nh nƒÉng |
| **Basic** | C√≥ th·ªÉ gi·ªõi h·∫°n | M·ªôt s·ªë t√≠nh nƒÉng c∆° b·∫£n |
| **Pro/VIP** | Kh√¥ng gi·ªõi h·∫°n | ƒê·∫ßy ƒë·ªß t√≠nh nƒÉng |
| **Admin** | Kh√¥ng gi·ªõi h·∫°n | ƒê·∫ßy ƒë·ªß + ƒë·∫∑c quy·ªÅn admin |

---

## ‚ö†Ô∏è ƒêi·ªÉm Y·∫øu & Vectors T·∫•n C√¥ng

### 1. **Frontend Bypass**
```javascript
// Ch·ªâ c·∫ßn set bi·∫øn n√†y = true
currentLicenseValid = true;
```

### 2. **Hosts File Redirect**
- Redirect `tool.puno2.com` v√† `crm.alosoft.vn` v·ªÅ server fake
- C·∫ßn bypass DNS whitelist check

### 3. **Registry Manipulation**
- Thay ƒë·ªïi gi√° tr·ªã trong `HKCU\Software\ATP` v√† `HKCU\Software\Intel`

### 4. **Local Proxy/MITM**
- Intercept v√† modify responses t·ª´ license servers
- C·∫ßn x·ª≠ l√Ω AES encryption

### 5. **Code Injection**
- Modify [renderer.js](file:///c:/Users/hp/AppData/Local/Programs/SimpleYTB/resources/app_extracted/renderer.js) trong [app.asar](file:///c:/Users/hp/AppData/Local/Programs/SimpleYTB/resources/app.asar)
- Patch c√°c h√†m [blockLicense()](file:///c:/Users/hp/AppData/Local/Programs/SimpleYTB/resources/app_extracted/renderer.js#3018-3026), [updateLicenseStatus()](file:///c:/Users/hp/AppData/Local/Programs/SimpleYTB/resources/app_extracted/renderer.js#2996-3017)

---

## üéØ Key c·ªßa b·∫°n

```
ATP-YTB-6630-6533-3532-6566-6337-6533-3535-3161-3833-6232-3438-3962-3764-3236-3461-6233
```

**Decoded HWID:** `f0e352efc7e3551a83b2489b7d264ab3`

ƒê·ªÉ ki·ªÉm tra tier c·ªßa key n√†y, b·∫°n c·∫ßn:
1. G·ªçi API `simple_exp4.php` v·ªõi key ƒë√£ m√£ h√≥a
2. Gi·∫£i m√£ response ƒë·ªÉ xem th√¥ng tin tier/expiry

---

## üìå K·∫øt Lu·∫≠n

H·ªá th·ªëng license c·ªßa SimpleYTB s·ª≠ d·ª•ng m√¥ h√¨nh **multi-layer verification**:
- **Layer 1:** Local validation (format check, registry)
- **Layer 2:** Remote validation (CRM + Puno servers)
- **Layer 3:** Anti-crack detection (PC code, encryption flag)
- **Layer 4:** Feature gating (frontend UI restrictions)

ƒê√¢y l√† h·ªá th·ªëng license kh√° ph·ª©c t·∫°p v·ªõi nhi·ªÅu l·ªõp b·∫£o v·ªá, tuy nhi√™n v·∫´n c√≥ th·ªÉ bypass v√¨ logic ch√≠nh n·∫±m ·ªü frontend JavaScript.
