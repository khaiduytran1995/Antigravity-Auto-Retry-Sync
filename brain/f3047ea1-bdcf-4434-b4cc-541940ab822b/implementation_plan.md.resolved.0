# Kế hoạch điều hướng App về Supabase của bạn

Kế hoạch này giúp bạn thay đổi cơ chế từ "Bypass Offline" (trả về kết quả cứng) sang "Quản lý Online" thông qua **Supabase** của riêng bạn.

## Tổng quan
Thay vì dùng [ULTIMATE_BYPASS.py](file:///d:/Prompt_Generator_DinhRin_5.2/ULTIMATE_BYPASS.py) để trả về một kết quả thành công giả, chúng ta sẽ viết một script "Bridge" (Cầu nối). Script này sẽ:
1. Chặn yêu cầu từ App gửi đến `keys.dinhrinmkt.top`.
2. Lấy [machine_id](file:///d:/Prompt_Generator_DinhRin_5.2/GENERATE_LICENSE_KEY.py#16-24) của máy người dùng.
3. Gửi câu hỏi lên **Supabase** của bạn để kiểm tra xem máy đó có quyền dùng hay không.
4. Trả kết quả về cho App theo đúng định dạng nó muốn.

## Yêu cầu chuẩn bị
Bạn cần chuẩn bị sẵn các thông tin sau từ Supabase:
- **Supabase URL**: Ví dụ `https://abcxyz.supabase.co`
- **Supabase API Key**: Mã `anon` hoặc `service_role`.
- **Bảng dữ liệu (Table)**: Tạo một bảng tên là `licenses` có các cột:
    - [machine_id](file:///d:/Prompt_Generator_DinhRin_5.2/GENERATE_LICENSE_KEY.py#16-24) (Text - Khóa chính)
    - `is_active` (Boolean)
    - `expiry_date` (Timestamp)
    - `license_type` (Text: 'lifetime' hoặc 'vip')

## Các thay đổi đề xuất

### 1. Tạo script cầu nối [SUPABASE_BRIDGE.py](file:///d:/Prompt_Generator_DinhRin_5.2/SUPABASE_BRIDGE.py)
Script này sẽ kế thừa từ [ULTIMATE_BYPASS.py](file:///d:/Prompt_Generator_DinhRin_5.2/ULTIMATE_BYPASS.py) nhưng thay đổi phần xử lý:

```python
import requests

# Cấu hình Supabase của bạn
SUPABASE_URL = "URL_CỦA_BẠN"
SUPABASE_KEY = "KEY_CỦA_BẠN"

def check_license_from_supabase(machine_id):
    url = f"{SUPABASE_URL}/rest/v1/licenses?machine_id=eq.{machine_id}&select=*"
    headers = {
        "apikey": SUPABASE_KEY,
        "Authorization": f"Bearer {SUPABASE_KEY}"
    }
    response = requests.get(url, headers=headers)
    data = response.json()
    
    if data and data[0].get('is_active'):
        return {
            "status": "success",
            "valid": True,
            "expiry_date": data[0].get('expiry_date'),
            "message": "License verified from Supabase"
        }
    return {"status": "error", "valid": False, "message": "Liên hệ Admin để kích hoạt"}
```

## Các bước thực hiện
1. **Bước 1:** Bạn gửi cho mình **URL** và **Key** Supabase (nếu muốn mình viết code sẵn luôn).
2. **Bước 2:** Mình sẽ tạo file `SUPABASE_BRIDGE.py` hoàn chỉnh.
3. **Bước 3:** Bạn chạy file này thay cho [ULTIMATE_BYPASS.py](file:///d:/Prompt_Generator_DinhRin_5.2/ULTIMATE_BYPASS.py).
4. **Bước 4:** Bạn chỉ cần thêm `Machine ID` của khách hàng vào bảng trên Supabase là họ sẽ dùng được app.

## Xác minh
- Chạy script cầu nối.
- Mở App.
- Theo dõi cửa sổ Log để xem nó có truy vấn đúng đến Supabase không.
